generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Assignment {
  id                   String               @id
  reference            String?              @unique
  title                String
  status               AssignmentStatus     @default(REQUESTED)
  partnerAssignedToId  String?
  propertyAddress      String?
  borrowerName         String?
  closingDate          DateTime?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  allowPartnerComments Boolean              @default(false)
  User                 User?                @relation(fields: [partnerAssignedToId], references: [id])
  AssignmentDocument   AssignmentDocument[]
  Comment              Comment[]
  StatusHistory        StatusHistory[]

  @@index([createdAt])
  @@index([partnerAssignedToId])
  @@index([status])
}

model AssignmentDocument {
  id                   String                 @id
  assignmentId         String
  key                  String
  filename             String
  uploadedAt           DateTime               @default(now())
  uploadedById         String?
  Assignment           Assignment             @relation(fields: [assignmentId], references: [id])
  User                 User?                  @relation(fields: [uploadedById], references: [id])
  DownloadLog          DownloadLog[]
  NotarizationDocument NotarizationDocument[]

  @@index([assignmentId])
  @@index([uploadedById])
}

model BackgroundError {
  id        String   @id
  source    String
  message   String
  stack     String?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([source])
}

model Booking {
  id                          String            @id
  signerId                    String?
  serviceId                   String
  notaryId                    String?
  scheduledDateTime           DateTime?
  actualEndDateTime           DateTime?
  status                      BookingStatus     @default(PAYMENT_PENDING)
  locationType                LocationType?
  addressStreet               String?
  addressCity                 String?
  addressState                String?
  addressZip                  String?
  locationNotes               String?
  priceAtBooking              Decimal?          @db.Decimal(10, 2)
  notes                       String?
  dailyRoomUrl                String?
  dailyRecordingId            String?
  kbaStatus                   String?
  idVerificationStatus        String?
  notaryJournalEntry          String?
  createdAt                   DateTime          @default(now())
  updatedAt                   DateTime
  confirmationEmailSentAt     DateTime?
  confirmationSmsSentAt       DateTime?
  followUpSentAt              DateTime?
  lastReminderSentAt          DateTime?
  noShowCheckPerformedAt      DateTime?
  reminder1hrSentAt           DateTime?
  reminder24hrSentAt          DateTime?
  reminder2hrSentAt           DateTime?
  depositAmount               Decimal?          @db.Decimal(10, 2)
  depositStatus               PaymentStatus?    @default(PENDING)
  promoCodeDiscount           Decimal?          @db.Decimal(10, 2)
  promoCodeId                 String?
  campaignName                String?
  customerEmail               String?
  ghlContactId                String?
  leadSource                  String?
  stripePaymentUrl            String?
  basePrice                   Decimal           @db.Decimal(10, 2)
  consentEmailUpdates         Boolean           @default(false)
  consentSmsNotifications     Boolean           @default(false)
  consentTermsConditions      Boolean           @default(false)
  documentCount               Int?
  finalPrice                  Decimal           @db.Decimal(10, 2)
  numberOfSigners             Int?              @default(1)
  paymentIntentId             String?
  promoDiscount               Decimal           @default(0) @db.Decimal(10, 2)
  proofAccessLink             String?
  proofNotarizationRecordId   String?
  proofStatus                 String?
  proofTransactionId          String?           @unique
  signerEmail                 String
  signerName                  String
  signerPhone                 String?
  utmCampaign                 String?
  utmMedium                   String?
  utmSource                   String?
  witnessType                 WitnessSource?   @map("witness_type")
  witnessFee                  Decimal?          @default(0) @map("witness_fee") @db.Decimal(5, 2)
  mileageMiles                Decimal?          @map("mileage_miles") @db.Decimal(5, 2)
  mileageFee                  Decimal?          @default(0) @map("mileage_fee") @db.Decimal(5, 2)
  urgencyLevel                String?           @default("standard") @map("urgency_level")
  urgencyFee                  Decimal?          @default(0) @map("urgency_fee") @db.Decimal(5, 2)
  estimatedCompletionTime     DateTime?       @map("estimated_completion_time")
  notaryTravelTimeMinutes     Int?              @map("notary_travel_time_minutes")
  googleMapsDistanceMatrix    Json?             @map("google_maps_distance_matrix")
  serviceAreaId               String?           @map("service_area_id")
  googleCalendarEventId       String?           @map("google_calendar_event_id")
  completedAt                 DateTime?         @map("completed_at")
  actualStartDateTime         DateTime?         @map("actual_start_date_time")
  User_Booking_notaryIdToUser User?             @relation("Booking_notaryIdToUser", fields: [notaryId], references: [id])
  PromoCode                   PromoCode?        @relation(fields: [promoCodeId], references: [id])
  Service                     Service           @relation(fields: [serviceId], references: [id])
  User_Booking_signerIdToUser User?             @relation("Booking_signerIdToUser", fields: [signerId], references: [id])
  NotificationLog             NotificationLog[]
  Payment                     Payment[]
  serviceArea                 ServiceArea?      @relation(fields: [serviceAreaId], references: [id])
  journalEntries              NotaryJournal[]
  totalSigners                Int?              @default(1) @map("total_signers")
  primarySignerConfirmed      Boolean           @default(false) @map("primary_signer_confirmed")
  allSignersConfirmed         Boolean           @default(false) @map("all_signers_confirmed")
  documentUploadDeadline      DateTime?         @map("document_upload_deadline")
  customInstructions          String?           @map("custom_instructions")
  bookingSigners              BookingSigner[]
  bookingDocuments            BookingDocument[]
  bookingAddons               BookingAddon[]

  @@index([createdAt])
  @@index([ghlContactId])
  @@index([leadSource])
  @@index([notaryId])
  @@index([scheduledDateTime])
  @@index([serviceId])
  @@index([signerEmail])
  @@index([signerId])
  @@index([status])
  @@index([urgencyLevel])
  @@index([serviceAreaId])
}

model BusinessSettings {
  id          String   @id
  key         String   @unique
  value       String
  dataType    String   @default("string")
  description String?
  category    String?
  updatedAt   DateTime
  updatedById String?
  serviceId   String?
  Service     Service? @relation(fields: [serviceId], references: [id])
  User        User?    @relation(fields: [updatedById], references: [id])

  @@index([category])
  @@index([key])
  @@index([serviceId])
  @@index([updatedById])
}

model Comment {
  id           String     @id
  text         String
  createdAt    DateTime   @default(now())
  assignmentId String
  authorId     String
  Assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  User         User       @relation(fields: [authorId], references: [id])

  @@index([assignmentId])
  @@index([authorId])
}

model DownloadLog {
  id                 String             @id
  documentId         String
  userId             String
  downloadedAt       DateTime           @default(now())
  AssignmentDocument AssignmentDocument @relation(fields: [documentId], references: [id])
  User               User               @relation(fields: [userId], references: [id])

  @@index([documentId])
  @@index([userId])
}

model InvitationToken {
  id        String    @id
  token     String    @unique
  email     String
  expiresAt DateTime
  createdAt DateTime  @default(now())
  createdBy String
  role      Role
  usedAt    DateTime?
  User      User      @relation(fields: [createdBy], references: [id])

  @@index([email])
  @@index([expiresAt])
  @@index([token])
}

model NotarizationDocument {
  id                   String             @id
  assignmentDocumentId String
  notarizationType     String
  notarizedAt          DateTime           @default(now())
  notaryId             String
  notes                String?
  AssignmentDocument   AssignmentDocument @relation(fields: [assignmentDocumentId], references: [id])
  User                 User               @relation(fields: [notaryId], references: [id])

  @@index([assignmentDocumentId])
  @@index([notaryId])
}

model NotificationLog {
  id           String             @id
  bookingId    String?
  method       NotificationMethod
  subject      String?
  message      String
  sentAt       DateTime?
  status       NotificationStatus @default(PENDING)
  errorMessage String?
  createdAt    DateTime           @default(now())
  deliveredAt  DateTime?
  failedAt     DateTime?
  recipient    String
  type         NotificationType
  userId       String?
  Booking      Booking?           @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([createdAt])
  @@index([status])
  @@index([type])
  @@index([userId])
}

model Payment {
  id                String          @id
  bookingId         String
  amount            Decimal         @db.Decimal(10, 2)
  status            PaymentStatus   @default(PENDING)
  provider          PaymentProvider @default(STRIPE)
  paidAt            DateTime?
  refundedAt        DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  currency          String          @default("USD")
  failureReason     String?
  providerPaymentId String?
  providerResponse  Json?
  refundAmount      Decimal?        @db.Decimal(10, 2)
  notes             String?
  Booking           Booking         @relation(fields: [bookingId], references: [id])

  @@index([bookingId])
  @@index([createdAt])
  @@index([provider])
  @@index([status])
}

model PromoCode {
  id                 String       @id
  code               String       @unique
  description        String?
  discountType       DiscountType @default(PERCENTAGE)
  discountValue      Decimal      @db.Decimal(10, 2)
  minimumAmount      Decimal?     @db.Decimal(10, 2)
  maxDiscountAmount  Decimal?     @db.Decimal(10, 2)
  usageLimit         Int?
  usageCount         Int          @default(0)
  perCustomerLimit   Int?         @default(1)
  validFrom          DateTime     @default(now())
  validUntil         DateTime?
  applicableServices String[]
  createdAt          DateTime     @default(now())
  updatedAt          DateTime
  createdById        String?
  active             Boolean      @default(true)
  Booking            Booking[]
  User               User?        @relation(fields: [createdById], references: [id])

  @@index([active])
  @@index([code])
  @@index([createdById])
  @@index([validFrom, validUntil])
}

model Service {
  id                     String             @id
  name                   String             @unique
  description            String?
  serviceType            ServiceType
  requiresDeposit        Boolean            @default(true)
  depositAmount          Decimal            @default(25.00) @db.Decimal(10, 2)
  createdAt              DateTime           @default(now())
  updatedAt              DateTime
  externalCalendarId     String?            @unique
  active                 Boolean            @default(true)
  bufferTimeMinutes      Int?               @default(15)
  duration               Int                @default(30)
  maxAdvanceBookingDays  Int?               @default(30)
  minAdvanceBookingHours Int?               @default(2)
  price                  Decimal            @db.Decimal(10, 2)
  Booking                Booking[]
  BusinessSettings       BusinessSettings[]

  @@index([active])
  @@index([createdAt])
  @@index([serviceType])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model StatusHistory {
  id           String           @id
  assignmentId String
  status       AssignmentStatus
  note         String?
  changedAt    DateTime         @default(now())
  changedById  String?
  Assignment   Assignment       @relation(fields: [assignmentId], references: [id])
  User         User?            @relation(fields: [changedById], references: [id])

  @@index([assignmentId])
  @@index([changedById])
}

model SystemAlert {
  id         String        @id
  component  String
  message    String
  severity   AlertSeverity @default(MEDIUM)
  status     AlertStatus   @default(ACTIVE)
  createdAt  DateTime      @default(now())
  resolvedAt DateTime?
  resolvedBy String?
  detail     Json?

  @@index([createdAt])
  @@index([severity])
  @@index([status])
}

model SystemLog {
  id        String   @id
  component String
  message   String
  level     LogLevel @default(INFO)
  timestamp DateTime @default(now())
  metadata  Json?
  userId    String?
  User      User?    @relation(fields: [userId], references: [id])

  @@index([component])
  @@index([level])
  @@index([timestamp])
  @@index([userId])
}

model User {
  id                             String                 @id
  name                           String?
  email                          String?                @unique
  emailVerified                  DateTime?
  image                          String?
  role                           Role                   @default(CLIENT)
  createdAt                      DateTime               @default(now())
  updatedAt                      DateTime
  onboardedAt                    DateTime?
  password                       String?
  active                         Boolean                @default(true)
  lastLoginAt                    DateTime?
  phone                          String?
  preferences                    Json?
  timezone                       String?                @default("America/Chicago")
  Account                        Account[]
  Assignment                     Assignment[]
  AssignmentDocument             AssignmentDocument[]
  Booking_Booking_notaryIdToUser Booking[]              @relation("Booking_notaryIdToUser")
  Booking_Booking_signerIdToUser Booking[]              @relation("Booking_signerIdToUser")
  BusinessSettings               BusinessSettings[]
  Comment                        Comment[]
  DownloadLog                    DownloadLog[]
  InvitationToken                InvitationToken[]
  NotarizationDocument           NotarizationDocument[]
  PromoCode                      PromoCode[]
  Session                        Session[]
  StatusHistory                  StatusHistory[]
  SystemLog                      SystemLog[]
  customerPreferences            Json?                  @map("customer_preferences")
  notaryAvailability             Json?                  @map("notary_availability")
  marketingConsent               Boolean                @default(false) @map("marketing_consent")
  smsConsent                     Boolean                @default(false) @map("sms_consent")
  pushNotificationToken          String?                @map("push_notification_token")
  notaryProfile                  NotaryProfile?
  journalEntries                 NotaryJournal[]
  createdFeatureFlags            FeatureFlag[]
  pushSubscriptions              PushSubscription[]
  bookingSigners                 BookingSigner[]        @relation("BookingSigner_userId")
  uploadedDocuments              BookingDocument[]      @relation("BookingDocument_uploadedBy")
  verifiedDocuments              BookingDocument[]      @relation("BookingDocument_verifiedBy")
  approvedAddons                 BookingAddon[]         @relation("BookingAddon_approvedBy")

  @@index([active])
  @@index([createdAt])
  @@index([email])
  @@index([role])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum AlertSeverity {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum AlertStatus {
  ACTIVE
  RESOLVED
  ACKNOWLEDGED
}

enum AssignmentStatus {
  REQUESTED
  SCHEDULED
  IN_PROGRESS
  SIGNED
  RETURNED_TO_TITLE
  COMPLETED
  ARCHIVED
}

enum BookingStatus {
  REQUESTED
  PAYMENT_PENDING
  CONFIRMED
  SCHEDULED
  AWAITING_CLIENT_ACTION
  READY_FOR_SERVICE
  IN_PROGRESS
  COMPLETED
  CANCELLED_BY_CLIENT
  CANCELLED_BY_STAFF
  REQUIRES_RESCHEDULE
  ARCHIVED
  NO_SHOW
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum LocationType {
  CLIENT_SPECIFIED_ADDRESS
  OUR_OFFICE
  REMOTE_ONLINE_NOTARIZATION
  PUBLIC_PLACE
}

enum LogLevel {
  ERROR
  WARN
  INFO
  DEBUG
}

enum NotificationMethod {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  BOUNCED
  UNSUBSCRIBED
}

enum NotificationType {
  BOOKING_CONFIRMATION
  PAYMENT_CONFIRMATION
  APPOINTMENT_REMINDER_24HR
  APPOINTMENT_REMINDER_2HR
  APPOINTMENT_REMINDER_1HR
  APPOINTMENT_REMINDER_NOW
  BOOKING_CANCELLED
  BOOKING_RESCHEDULED
  PAYMENT_FAILED
  PAYMENT_REMINDER
  NO_SHOW_CHECK
  POST_SERVICE_FOLLOWUP
  REVIEW_REQUEST
  DOCUMENT_READY
  DOCUMENT_REMINDER
  NOTARY_ASSIGNMENT
  EMERGENCY_NOTIFICATION
  LEAD_NURTURING
  PAYMENT_UPDATE
}

enum PaymentProvider {
  STRIPE
  SQUARE
  PAYPAL
  MANUAL
  OTHER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  VOIDED
}

enum Role {
  ADMIN
  STAFF
  PARTNER
  SIGNER
  NOTARY
  CLIENT
}

enum ServiceType {
  STANDARD_NOTARY
  EXTENDED_HOURS_NOTARY
  LOAN_SIGNING_SPECIALIST
  SPECIALTY_NOTARY_SERVICE
  BUSINESS_SOLUTIONS
  SUPPORT_SERVICE
}

// Additional enums for v1.2 functionality
enum WitnessSource {
  CUSTOMER_PROVIDED
  STAFF_PROVIDED  
  PROOF_PROVIDED
}

enum UrgencyLevel {
  STANDARD
  SAME_DAY
  EMERGENCY
}

// New models for v1.2 specification

model NotaryProfile {
  id                    String   @id @default(cuid())
  userId                String   @unique
  commissionNumber      String?  @map("commission_number")
  commissionExpiry      DateTime? @map("commission_expiry")
  baseAddress           String?  @map("base_address")
  serviceRadiusMiles    Int      @default(25) @map("service_radius_miles")
  isActive              Boolean  @default(true) @map("is_active")
  emergencyContact      String?  @map("emergency_contact")
  preferredServiceTypes String[] @map("preferred_service_types")
  dailyCapacity         Int      @default(8) @map("daily_capacity")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("notary_profiles")
}

model NotaryJournal {
  id               String   @id @default(cuid())
  bookingId        String?  @map("booking_id")
  notaryId         String   @map("notary_id")
  entryDate        DateTime @map("entry_date") @db.Date
  journalNumber    Int?     @map("journal_number")
  documentType     String?  @map("document_type")
  signerName       String?  @map("signer_name")
  signerIdType     String?  @map("signer_id_type")
  signerIdState    String?  @map("signer_id_state")
  notarialActType  String?  @map("notarial_act_type")
  feeCharged       Decimal? @map("fee_charged") @db.Decimal(10, 2)
  location         String?
  additionalNotes  String?  @map("additional_notes")
  createdAt        DateTime @default(now()) @map("created_at")
  
  booking Booking? @relation(fields: [bookingId], references: [id])
  notary  User     @relation(fields: [notaryId], references: [id])
  
  @@unique([notaryId, journalNumber])
  @@index([bookingId])
  @@index([notaryId, entryDate])
  @@map("notary_journal")
}

model ServiceArea {
  id                    String   @id @default(cuid())
  name                  String
  description           String?
  polygonCoordinates    Json?    @map("polygon_coordinates")
  serviceFeeMultiplier  Decimal  @default(1.0) @map("service_fee_multiplier") @db.Decimal(3, 2)
  active                Boolean  @default(true)
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  bookings Booking[]
  
  @@index([active])
  @@map("service_areas")
}

model MileageCache {
  id                   String   @id @default(cuid())
  originAddress        String   @map("origin_address")
  destinationAddress   String   @map("destination_address")
  distanceMiles        Decimal? @map("distance_miles") @db.Decimal(5, 2)
  durationMinutes      Int?     @map("duration_minutes")
  googleMapsResponse   Json?    @map("google_maps_response")
  lastCalculated       DateTime @default(now()) @map("last_calculated")
  hitCount             Int      @default(1) @map("hit_count")
  
  @@unique([originAddress, destinationAddress])
  @@index([lastCalculated])
  @@map("mileage_cache")
}

model DailyMetric {
  date                  DateTime @id @db.Date
  totalBookings         Int      @default(0) @map("total_bookings")
  mobileBookings        Int      @default(0) @map("mobile_bookings")
  ronBookings           Int      @default(0) @map("ron_bookings")
  completedBookings     Int      @default(0) @map("completed_bookings")
  cancelledBookings     Int      @default(0) @map("cancelled_bookings")
  totalRevenue          Decimal  @default(0) @map("total_revenue") @db.Decimal(10, 2)
  mobileRevenue         Decimal  @default(0) @map("mobile_revenue") @db.Decimal(10, 2)
  ronRevenue            Decimal  @default(0) @map("ron_revenue") @db.Decimal(10, 2)
  proofCosts            Decimal  @default(0) @map("proof_costs") @db.Decimal(10, 2)
  mileageCosts          Decimal  @default(0) @map("mileage_costs") @db.Decimal(10, 2)
  stripeFees            Decimal  @default(0) @map("stripe_fees") @db.Decimal(10, 2)
  netRevenue            Decimal  @default(0) @map("net_revenue") @db.Decimal(10, 2)
  marginPercentage      Decimal? @map("margin_percentage") @db.Decimal(5, 2)
  averageBookingValue   Decimal? @map("average_booking_value") @db.Decimal(10, 2)
  conversionRate        Decimal? @map("conversion_rate") @db.Decimal(5, 2)
  customerSatisfaction  Decimal? @map("customer_satisfaction") @db.Decimal(3, 2)
  newCustomers          Int      @default(0) @map("new_customers")
  repeatCustomers       Int      @default(0) @map("repeat_customers")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  @@map("daily_metrics")
}

model FeatureFlag {
  key               String   @id
  enabled           Boolean  @default(false)
  description       String?
  rolloutPercentage Int      @default(0) @map("rollout_percentage")
  targetRoles       String[] @map("target_roles")
  targetUsers       String[] @map("target_users")
  environment       String   @default("development")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  createdBy         String?  @map("created_by")
  
  creator User? @relation(fields: [createdBy], references: [id])
  
  @@index([environment])
  @@map("feature_flags")
}

model PushSubscription {
  id        String   @id @default(cuid())
  userId    String
  endpoint  String
  p256dh    String
  auth      String
  userAgent String   @default("")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Unique constraint to prevent duplicate subscriptions
  @@unique([userId, endpoint], name: "userId_endpoint")
  @@map("push_subscriptions")
}

model BookingSigner {
  id                    String   @id @default(cuid())
  bookingId             String   @map("booking_id")
  signerId              String?  @map("signer_id") // Optional - for registered users
  signerName            String   @map("signer_name")
  signerEmail           String   @map("signer_email")
  signerPhone           String?  @map("signer_phone")
  signerRole            String   @default("PRIMARY") @map("signer_role") // PRIMARY, SECONDARY, WITNESS, etc.
  idVerificationStatus  String   @default("PENDING") @map("id_verification_status") // PENDING, VERIFIED, FAILED
  signatureStatus       String   @default("PENDING") @map("signature_status") // PENDING, SIGNED, DECLINED
  notificationPreference String  @default("EMAIL") @map("notification_preference") // EMAIL, SMS, BOTH
  specialInstructions   String?  @map("special_instructions")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")
  
  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  user    User?   @relation("BookingSigner_userId", fields: [signerId], references: [id])
  
  @@index([bookingId])
  @@index([signerId])
  @@index([signerEmail])
  @@map("booking_signers")
}

// Enhanced Document Management for Phase 1
model BookingDocument {
  id                String   @id @default(cuid())
  bookingId         String   @map("booking_id")
  documentName      String   @map("document_name")
  documentType      String   @map("document_type") // CONTRACT, ID_DOCUMENT, SUPPORTING_DOC, etc.
  s3Key             String   @map("s3_key")
  s3Bucket          String   @map("s3_bucket")
  fileName          String   @map("file_name")
  fileSize          Int      @map("file_size")
  mimeType          String   @map("mime_type")
  uploadedBy        String?  @map("uploaded_by") // User ID who uploaded
  uploadedAt        DateTime @default(now()) @map("uploaded_at")
  isRequired        Boolean  @default(false) @map("is_required")
  isVerified        Boolean  @default(false) @map("is_verified")
  verifiedBy        String?  @map("verified_by")
  verifiedAt        DateTime? @map("verified_at")
  notes             String?
  
  // Relations
  booking     Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  uploadedByUser User? @relation("BookingDocument_uploadedBy", fields: [uploadedBy], references: [id])
  verifiedByUser User? @relation("BookingDocument_verifiedBy", fields: [verifiedBy], references: [id])
  
  @@index([bookingId])
  @@index([documentType])
  @@index([uploadedBy])
  @@map("booking_documents")
}

// Service Add-ons for customization
model ServiceAddon {
  id                String  @id @default(cuid())
  name              String
  description       String?
  addonType         String  // WITNESS, APOSTILLE, EXTRA_COPY, RUSH_SERVICE, etc.
  price             Decimal @db.Decimal(10, 2)
  isActive          Boolean @default(true) @map("is_active")
  requiresApproval  Boolean @default(false) @map("requires_approval")
  maxQuantity       Int?    @map("max_quantity")
  applicableServices String[] @map("applicable_services") // Service IDs this addon applies to
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  // Relations
  bookingAddons BookingAddon[]
  
  @@index([addonType])
  @@index([isActive])
  @@map("service_addons")
}

model BookingAddon {
  id          String  @id @default(cuid())
  bookingId   String  @map("booking_id")
  addonId     String  @map("addon_id")
  quantity    Int     @default(1)
  unitPrice   Decimal @db.Decimal(10, 2) @map("unit_price")
  totalPrice  Decimal @db.Decimal(10, 2) @map("total_price")
  isApproved  Boolean @default(true) @map("is_approved")
  approvedBy  String? @map("approved_by")
  approvedAt  DateTime? @map("approved_at")
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  
  // Relations
  booking    Booking      @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  addon      ServiceAddon @relation(fields: [addonId], references: [id])
  approver   User?        @relation("BookingAddon_approvedBy", fields: [approvedBy], references: [id])
  
  @@index([bookingId])
  @@index([addonId])
  @@map("booking_addons")
}
