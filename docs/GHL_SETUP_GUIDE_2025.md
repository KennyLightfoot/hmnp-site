# ğŸš€ Houston Mobile Notary Pros â€“ GoHighLevel PRIVATE INTEGRATION GUIDE **2025**

> **This replaces `GHL_COMPLETE_SETUP_GUIDE_2024.md`.**  
> The old file referenced deprecated v1 endpoints, legacy custom-field names and missing workflows.  
> Feel free to remove the 2024 guide once you've reviewed this one.

---

## 1  ğŸ¯ What You'll Get After Following This Guide

| Area | Outcome |
|------|---------|
| Custom Fields & Tags | Only the **fields/tags actually referenced in the codebase** get created â€“ nothing more, nothing less. |
| Webhooks | Stripe, Document-upload, Review, Booking notifications & Calendar sync covered via **GHL private-integration (v2)** endpoints. |
| Workflows | 10 production-ready automations (payment follow-up, confirmations, cancellations, etc.). |
| Two-way Calendar | Google Calendar â†’ GHL sync using the new `/calendar` API. |

---

## 2  âš¡ Quick-Start Checklist

1. **Environment vars** â€“ copy the snippet below into `.env` and fill the blanks.  
2. `pnpm dlx ts-node scripts/create-minimal-ghl-fields.js`  
3. `pnpm dlx ts-node scripts/create-minimal-ghl-tags.js`  
4. In the GHL UI create the webhooks listed in Section 4.  
5. Import / build the workflows with the templates in `docs/workflows/`.  
6. Run the validation script: `pnpm ts-node scripts/diagnostics/validate-ghl-setup.ts` (will error if anything's missing).

> **Total time:** â‰ˆ 25 minutes (most is copy-pasting IDs in the GHL dashboard).

---

## 3  ğŸ”§ Environment Variables

```env
# Core auth
GHL_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxx
GHL_LOCATION_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
GHL_API_BASE_URL=https://services.leadconnectorhq.com

# Stripe
STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxx

# Site callbacks
PUBLIC_APP_BASE_URL=https://houstonmobilenotarypros.com
```

> `GHL_API_BASE_URL` can change if LC updates regions â€“ keep it configurable.

---

## 4  ğŸ“¨ Webhooks to Configure in GHL (`Settings` â†’ `API & Webhooks`)

| Event | Endpoint (your **Next JS API Route**) |
|-------|--------------------------------------|
| `checkout.session.completed` | `/api/webhooks/stripe` |
| `payment_intent.payment_failed` | `/api/webhooks/stripe` |
| `charge.refunded` | `/api/webhooks/stripe` |
| `document.uploaded` | `/api/webhooks/documents` |
| `review.created` | `/api/webhooks/reviews` |
| `booking.updated` | `/api/webhooks/bookings` |

Make sure you paste the **Signing Secret** for each webhook into Vercel â†’ Environment Variables.

---

## 5  ğŸ·ï¸ Required Tags (exact, case-sensitive)

These are the tags hard-coded in the repo today (output of `scripts/create-minimal-ghl-tags.js`).

```
status:booking_pendingpayment
status:payment_completed
status:booking_confirmed
status:booking_cancelled
status:booking_created
status:booking_created_phone

payment:failed_attempt
stripe:payment_completed
stripe:payment_failed
stripe:refund_processed
stripe:webhook_processed

booking:rescheduled
action:cancel_booking
action:reschedule_booking
priority:high_touch
urgency:new
urgency:medium
urgency:high
urgency:critical
consent:sms_opt_in
consent:marketing_opt_in
lead:new
lead:offered_discount
```

> **Pro-tip:** Run the tag script â€“ it uses the v2 endpoint and skips anything that already exists.

---

## 6  ğŸ—‚ï¸ Required Custom Fields (prefix **`cf_`**)  
*(Generated by `scripts/create-minimal-ghl-fields.js` â€“ keep script authoritative.)*

| Field Key | Type | Purpose |
|-----------|------|---------|
| `cf_booking_id` | Text | Primary key linking GHL contact â†” booking record |
| `cf_service_address` | Large Text | Full street address |
| `cf_service_type` | Text | Human-readable service name |
| `cf_total_amount` | Currency | Value used in emails & SMS |
| `cf_payment_url` | Text | Stripe Checkout URL |
| `cf_appointment_date` | Date | Displayed in confirmations |
| `cf_appointment_time` | Text | "2:30 PM" |
| `cf_appointment_datetime` | Text | ISO date-time string |
| `cf_payment_status` | Text | PENDING / COMPLETED / FAILED |
| `cf_refund_amount` | Currency | Used by refund flow |
| `cf_last_stripe_webhook_date` | Text | Auditing |
| *â€¦plus 20 more* â€“ see the script for the full authoritative list.

> If you rename a field in code, **add the new key here AND deprecate the old one**.

---

## 7  ğŸ¤– Workflows (High-level Summary)

| # | Name | Trigger Tag | Key Actions |
|---|------|-------------|------------|
| 1 | **Payment Follow-Up** | `status:booking_pendingpayment` | Sends urgency-based reminders & tasks until payment succeeds. |
| 2 | **Confirmation + Reminders** | `status:booking_confirmed` | Wait â†’ 24 hr email/SMS â†’ 2 hr SMS â†’ provider tasks. |
| 3 | **Stripe Webhook Processor** | `stripe:*` | Tag cleanup + status updates + human tasks. |
| 4 | **Cancellation Handler** | `action:cancel_booking` | Calls `/api/bookings/cancel` â†’ refund logic â†’ comms. |
| 5 | **Reschedule Handler** | `action:reschedule_booking` | Calls `/api/bookings/reschedule` â†’ fee calc â†’ comms. |
| 6 | **New Booking Notification** | `status:booking_created` | Internal tasks & priority routing. |
| 7 | **Phone â†’ Booking** | `lead:phone_qualified` | Creates booking via `/api/bookings/sync`. |
| 8 | **Emergency Service** | `Service:Emergency` / `Priority:Same_Day` | SLA task + SMS. |
| 9 | **No-Show Recovery** | `status:no_show` | Friendly follow-ups, reschedule link, provider task. |
| 10 | **Post-Service Follow-up** | `status:service_completed` | Thank-you â†’ review request â†’ referral offer. |

Workflow JSON exports live under `docs/workflows/` for one-click import.

> You can import pre-built JSON templates for every workflow from [`docs/workflows/`](./workflows/).  In the GHL Workflow Builder hit â€¢â€¢â€¢ â†’ *Import Workflow* â†’ *Upload JSON* and select the matching file.

---

## 8  ğŸ”’ Security & Best Practices (applied in code)

1. All secrets pulled from env â€“ never committed.  
2. Incoming webhooks are validated with SHA-256 HMAC (see `lib/ghl-webhook-security.ts`).  
3. File uploads virus-scanned via S3 ClamAV Lambda.  
4. Stripe events verified with official SDK signature check.  
5. Prisma soft-delete & least-privilege DB role enforced.

---

## 9  ğŸ› ï¸ Validation Script

Run `pnpm ts-node scripts/diagnostics/validate-ghl-setup.ts` â€“ it checks:
* All required tags exist.
* All required custom fields exist with correct **data type**.
* Each webhook endpoint is registered & enabled.

CI fails if any mismatch â–¶ prevents deploying a broken environment.

---

## 10  ğŸ“ Need Help?

Shoot Kenneth a text at **832-617-4285** or open an issue in the `internal-ops` Jira project.

---

**Happy automating â€“ let's notarize Houston!** 